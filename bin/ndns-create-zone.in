#!/usr/bin/env python
# -*- Mode:python; c-file-style:"gnu"; indent-tabs-mode:nil -*- */
# 
# Copyright (c) 2013, Regents of the University of California
#                     Alexander Afanasyev
# 
# BSD license, See the doc/LICENSE file for more information
# 
# Author: Alexander Afanasyev <alexander.afanasyev@ucla.edu>
# 

import sys
sys.path = ["@LIBDIR@/ndns"] + sys.path

import argparse
import os
from ndns.tools.create_zone import create_zone

######################################################################
######################################################################
######################################################################

parser = argparse.ArgumentParser(description='Create NDNS zone')
parser.add_argument('zone', metavar='zone', type=str,
                    help='''NDN name of the zone to create''')
parser.add_argument('--ttl', dest='ttl', type=int, default=3600,
                    help='''TTL for the created zone''')
parser.add_argument('--mname', dest='mname', type=str, default='ns',
                    help='''The <domain-name> of the name server that was the original or primary source of data for this zone.''')
parser.add_argument('--rname', dest='rname', type=str, default='root',
                    help='''A <domain-name> which specifies the mailbox of the person responsible for this zone.''')

parser.add_argument('--default-ksk', dest='default_ksk', action='store_true', default=False,
                    help='''Use default key and keylocator (the one specified via CCN_DIR) instead of autogenerated one.
                            (Normally, this parameter should not be used at all, but is necessary for the root zone)''')
parser.add_argument('--ksk-id', dest='ksk_id',
                    help='''KSK id (autogenerated if not specified explicitly). 
                            If NDN name, then this name will override an automatically generated 
                            one or default name of the key''')
parser.add_argument('--zsk-id', dest='zsk_id',
                    help='''ZSK id (autogenerated if not specified explicitly)''')
                            
parser.add_argument('--data-dir', dest='data_dir', type=str, default="@LOCALSTATEDIR@/ndns",
                    help='''Directory that will store NDNS database and key files [default: @LOCALSTATEDIR@/ndns]''')

args = parser.parse_args()

if (not args.zone):
    parser.print_help ()
    exit (1)

######################################################################
######################################################################
######################################################################

if( __name__ == '__main__' ):
    create_zone (args)

    # reload daemon config, if necessary
    os.system ("killall -USR1 ndns-daemon")
